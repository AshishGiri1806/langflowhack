import{j as s,r as x,h as w,aS as Z,aT as U,by as he,aN as z,aw as b,b8 as ee,aQ as se,I as u,bz as pe,u as Q,af as fe,ae as D,S as j,aP as we,b9 as ge,f as C,bb as W,bA as je}from"./index-e8QJh9aC.js";import{S as F,I as be}from"./index-CveeD_kd.js";import{D as X}from"./index-DU-McIir.js";import{C as ve}from"./checkbox-C_SFShR-.js";import{c as Ne,e as ye}from"./form-Bg8t85Kg.js";import{I as ke}from"./input-CR-TkjST.js";const Ge=()=>s.jsxs("div",{className:"skeleton-card",children:[s.jsxs("div",{className:"skeleton-card-wrapper",children:[s.jsx(F,{className:"h-8 w-8 rounded-full"}),s.jsx(F,{className:"h-4 w-[40%]"})]}),s.jsxs("div",{className:"skeleton-card-text",children:[s.jsx(F,{className:"h-3 w-[90%]"}),s.jsx(F,{className:"h-3 w-[80%]"})]})]}),Ce=(e,t,a,l)=>{x.useEffect(()=>{e&&(t((e==null?void 0:e.liked_by_user)??!1),a((e==null?void 0:e.liked_by_count)??0),l((e==null?void 0:e.downloads_count)??0))},[e,e==null?void 0:e.liked_by_count,e==null?void 0:e.liked_by_user,e==null?void 0:e.downloads_count])},Se=Ce,_e=(e,t,a,l,d,o,r,m)=>{const h=w(i=>i.addFlow);return{handleInstall:()=>{const i=l;d(p=>Number(p)+1),o(!0),Z(e.id).then(p=>{const c=U(p,p.id,e.is_component);h(!0,c).then(S=>{r({title:`${t} Installed Successfully.`}),o(!1)}).catch(S=>{o(!1),m({title:`Error installing the ${t}`,list:[S.response.data.detail]})})}).catch(p=>{o(!1),m({title:`Error installing the ${t}`,list:[p.response.data.detail]}),d(i)})}}},Ie=_e,Fe=(e,t,a,l,d,o,r,m,h)=>({handleLike:()=>{if(a(!0),l!==void 0||l!==null){const i=l,p=d;o(c=>!c),r(c=>i?c-1:c+1),he(e.id).then(c=>{a(!1),r(c.data.likes_count),o(c.data.liked_by_user)}).catch(c=>{a(!1),r(p),o(i),c.response.status===403?m(!1):(console.error(c),h({title:`Error liking ${t}.`,list:[c.response.data.detail]}))})}}}),Pe=Fe;function $e({data:e}){return s.jsx(s.Fragment,{children:s.jsx(z,{draggable:!0,className:b("group relative flex flex-col justify-between overflow-hidden transition-all hover:bg-muted/50 hover:shadow-md hover:dark:bg-[#ffffff10]"),children:s.jsx("div",{children:s.jsx(ee,{children:s.jsx("div",{children:s.jsxs(se,{className:"flex w-full items-start justify-between gap-3 text-xl",children:[s.jsx(u,{className:b("visible flex-shrink-0",e.is_component?"mx-0.5 h-6 w-6 text-component-icon":"h-7 w-7 flex-shrink-0 text-flow-icon"),name:e.is_component?"ToyBrick":"Group"}),s.jsx("div",{className:"w-full truncate pr-3",children:e.name})]})})})})})})}const De=e=>{const t=w(l=>l.getFlowById);return{onDragStart:x.useCallback(l=>{let d=s.jsx($e,{data:e});const o=document.createElement("div");o.style.transform="translate(-10000px, -10000px)",o.style.position="absolute",document.body.appendChild(o),l.dataTransfer.setDragImage(o,0,0),pe(o).render(d),t(e.id)&&l.dataTransfer.setData("flow",JSON.stringify(e))},[e])}},Ee=De,Te=(e,t,a,l,d,o,r)=>{x.useEffect(()=>{var m,h;e&&t&&(a?(d(((m=l==null?void 0:l.data)==null?void 0:m.nodes)??[],!0),o(((h=l==null?void 0:l.data)==null?void 0:h.edges)??[],!0)):(d([],!0),o([],!0)),r())},[a])},Le=Te;function Y(e){return e.replace(/ /g,"-").toLowerCase()}function Ke({data:e,authorized:t=!0,disabled:a=!1,button:l,onClick:d,onDelete:o,playground:r,control:m,is_component:h}){var R;const N=Q(n=>n.setSuccessData),i=Q(n=>n.setErrorData),p=fe(n=>n.updateValidApiKey),c=D(n=>n.CleanFlowPool),S=!1,[y,ne]=x.useState(!1),[te,oe]=x.useState(!1),[E,T]=x.useState((e==null?void 0:e.liked_by_user)??!1),[L,A]=x.useState((e==null?void 0:e.liked_by_count)??0),[B,O]=x.useState((e==null?void 0:e.downloads_count)??0),le=w(n=>n.currentFlow),M=w(n=>n.setCurrentFlow),H=w(n=>n.getFlowById),re=w(n=>n.currentFlowId),ie=D(n=>n.setNodes),ce=D(n=>n.setEdges),[P,k]=x.useState(!1),[V,ae]=x.useState(!1),q=w(n=>n.setCurrentFlowId),[_,f]=x.useState(!1),$=w(n=>n.selectedFlowsComponentsCards),G=e.is_component?"Component":"Flow";async function K(){const n=await Z(e.id);return U(n,n.id,e.is_component,!0)}function I(n){var J;if(!n)return!1;const{inputs:g,outputs:v}=je(((J=n==null?void 0:n.data)==null?void 0:J.nodes)??[]);return g.length>0||v.length>0}Le(re,r,P,le,ie,ce,c),Se(e,T,A,O);const{handleInstall:de}=Ie(e,G,S,B,O,ne,N,i),{handleLike:me}=Pe(e,G,oe,E,L,T,A,p,i),ue=($==null?void 0:$.includes(e==null?void 0:e.id))??!1,{onDragStart:xe}=Ee(e);return s.jsxs(s.Fragment,{children:[s.jsxs(z,{onDragStart:xe,draggable:!0,"data-testid":`card-${Y(e.name)}`,className:b("group relative flex h-[11rem] flex-col justify-between overflow-hidden hover:bg-muted/50 hover:shadow-md hover:dark:bg-[#5f5f5f0e]",a?"pointer-events-none opacity-50":"",d?"cursor-pointer":"",ue?"border border-selected":""),onClick:d,children:[s.jsx("div",{children:s.jsxs(ee,{children:[s.jsx("div",{children:s.jsxs(se,{className:"flex w-full items-start justify-between gap-3 text-xl",children:[s.jsx(u,{className:b("visible flex-shrink-0",e.is_component?"mx-0.5 h-6 w-6 text-component-icon":"h-7 w-7 flex-shrink-0 text-flow-icon"),name:e.is_component?"ToyBrick":"Group"}),s.jsx(j,{content:e.name,children:s.jsx("div",{className:"w-full truncate pr-3",children:e.name})}),(e==null?void 0:e.metadata)!==void 0&&s.jsxs("div",{className:"flex items-center gap-3",children:[e.private&&s.jsx(j,{content:"Private",children:s.jsx("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:s.jsx(u,{name:"Lock",className:"h-4 w-4"})})}),!e.is_component&&s.jsx(j,{content:"Components",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(u,{name:"ToyBrick",className:"h-4 w-4"}),s.jsx("span",{"data-testid":`total-${e.name}`,children:((R=e==null?void 0:e.metadata)==null?void 0:R.total)??0})]})}),s.jsx(j,{content:"Likes",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(u,{name:"Heart",className:b("h-4 w-4")}),s.jsx("span",{"data-testid":`likes-${e.name}`,children:L??0})]})}),s.jsx(j,{content:"Downloads",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(u,{name:"DownloadCloud",className:"h-4 w-4"}),s.jsx("span",{"data-testid":`downloads-${e.name}`,children:B??0})]})})]}),m&&s.jsx("div",{className:"flex",onClick:n=>{n.stopPropagation()},children:s.jsx(Ne,{control:m,name:`${e.id}`,defaultValue:!1,render:({field:n})=>s.jsx(ye,{children:s.jsx(ve,{"data-testid":"checkbox-component","aria-label":"checkbox-component",checked:n.value,onCheckedChange:n.onChange,className:"h-5 w-5 border border-ring data-[state=checked]:border-selected data-[state=checked]:bg-selected"})})})})]})}),s.jsxs("div",{className:"flex gap-2",children:[e.user_created&&e.user_created.username&&s.jsxs("span",{className:"text-sm text-primary",children:["by ",s.jsx("b",{children:e.user_created.username}),e.last_tested_version&&s.jsxs(s.Fragment,{children:[" ","|"," ",s.jsxs("span",{className:"text-xs",children:[" ","⛓︎ v",e.last_tested_version]})]})]}),s.jsx("div",{className:"flex w-full flex-1 flex-wrap gap-2"})]}),s.jsx(we,{className:"pb-2 pt-2",children:s.jsx("div",{className:(e==null?void 0:e.metadata)!==void 0?"truncate":"truncate-doubleline",children:e.description})})]})}),s.jsx(ge,{children:s.jsx("div",{className:"z-50 flex w-full items-center justify-between gap-2",children:s.jsxs("div",{className:"flex w-full flex-wrap items-end justify-end gap-2",children:[r&&(e==null?void 0:e.metadata)!==void 0?s.jsxs(C,{disabled:_||!t,tabIndex:-1,variant:"outline",size:"sm",className:"z-50 gap-2 whitespace-nowrap","data-testid":"playground-flow-button-"+e.id,onClick:n=>{n.preventDefault(),n.stopPropagation(),f(!0);const g=H(e.id);if(g){if(!I(g)){i({title:"Error",list:["This flow doesn't have a playground."]}),f(!1);return}q(e.id),k(!0),f(!1)}else K().then(v=>{if(!I(v)){i({title:"Error",list:["This flow doesn't have a playground."]}),f(!1);return}M(v),k(!0),f(!1)})},children:[_?s.jsx(W,{className:"h-4 w-4 text-medium-indigo"}):s.jsx(u,{name:"BotMessageSquareIcon",className:"h-4 w-4 select-none"}),"Playground"]},e.id):void 0,e.liked_by_count!=null&&s.jsxs("div",{className:"flex gap-0.5",children:[o&&(e==null?void 0:e.metadata)!==void 0?s.jsx(j,{content:t?"Delete":"Please review your API key.",children:s.jsx(X,{onConfirm:o,children:s.jsx(C,{variant:"ghost",size:"icon",className:"whitespace-nowrap"+(t?"":" cursor-not-allowed"),children:s.jsx(u,{"data-testid":`delete-${Y(e.name)}`,name:"Trash2",className:b("h-5 w-5",t?"":"text-ring")})})})}):s.jsx(j,{content:t?"Like":"Please review your API key.",children:s.jsx(C,{disabled:te,variant:"ghost",size:"icon",className:"whitespace-nowrap"+(t?"":" cursor-not-allowed"),onClick:()=>{t&&me()},"data-testid":`like-${e.name}`,children:s.jsx(u,{name:"Heart",className:b("h-5 w-5",E?"fill-destructive stroke-destructive":"",t?"":"text-ring")})})}),s.jsx(j,{content:t?"Install Locally":"Please review your API key.",children:s.jsx(C,{disabled:y,variant:"ghost",size:"icon",className:"whitespace-nowrap"+(t?"":" cursor-not-allowed")+(y?"":" p-0.5"),onClick:()=>{y||!t||de()},"data-testid":`install-${e.name}`,children:s.jsx(u,{name:y?"Loader2":"Plus",className:b(y?"h-5 w-5 animate-spin":"h-5 w-5",t?"":"text-ring")})})})]}),r&&(e==null?void 0:e.metadata)===void 0&&s.jsxs(C,{disabled:_||!t,tabIndex:-1,variant:"primary",size:"sm",className:"gap-2 whitespace-nowrap bg-muted","data-testid":"playground-flow-button-"+e.id,onClick:n=>{n.preventDefault(),n.stopPropagation(),f(!0);const g=H(e.id);if(g){if(!I(g)){i({title:"Error",list:["This flow doesn't have a playground."]}),f(!1);return}q(e.id),k(!0),f(!1)}else K().then(v=>{if(!I(v)){i({title:"Error",list:["This flow doesn't have a playground."]}),f(!1);return}M(v),k(!0),f(!1)})},children:[_?s.jsx(W,{className:"h-4 w-4 text-medium-indigo"}):s.jsx(u,{name:"BotMessageSquareIcon",className:"h-4 w-4 select-none"}),"Playground"]},e.id)]})})})]}),P&&s.jsx(be,{cleanOnClose:!0,open:P,setOpen:k,children:s.jsx(s.Fragment,{})}),V&&s.jsx(X,{open:V,setOpen:ae,onConfirm:()=>{o&&o()},description:` ${h?"component":"flow"}`,children:s.jsx(s.Fragment,{})})]})}const Ae=({loading:e,divClasses:t,onChange:a,onClick:l,value:d,onKeyDown:o})=>{const r=window.location.pathname,m=w(i=>i.allFlows),h=e||!m,N=()=>r.includes("flows")?"Search Flows":r.includes("components")?"Search Components":"Search Flows and Components";return s.jsx(s.Fragment,{children:s.jsxs("div",{className:`${t||"relative h-12 w-[60%]"}`,children:[s.jsx(ke,{"data-testid":"search-store-input",disabled:h,placeholder:N(),className:"absolute h-12 pl-5 pr-12",onChange:a,onKeyDown:o,value:d}),s.jsx("button",{onClick:l,disabled:e,className:"absolute bottom-0 right-4 top-0 my-auto h-6 cursor-pointer stroke-1 text-muted-foreground","data-testid":"search-store-button",children:s.jsx(u,{name:e?"Loader2":"Search",className:e?"animate-spin cursor-not-allowed":""})})]})})},Re=Ae;export{Ke as C,Re as I,Ge as S};
