import{j as o,av as ee,aw as P,aU as U,aV as ae,ay as f,u as _,h as A,aW as ne,aX as oe,aA as se,aB as re,aY as te,r as C,ax as V,f as T,aZ as $,I as L,a_ as le,aH as de,aG as ce}from"./index-e8QJh9aC.js";import{H as ie}from"./index-BgPOWpTS.js";import{I as fe}from"./input-CR-TkjST.js";const ue=({items:m,pathname:d})=>o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:m.map(r=>o.jsx(ee,{to:r.href,children:o.jsxs("div",{"data-testid":`sidebar-nav-${r.title}`,className:P(U({variant:"ghost"}),d===r.href?"border border-border bg-muted hover:bg-muted":"border border-transparent hover:border-border hover:bg-transparent","flex w-full shrink-0 justify-start gap-4"),children:[r.icon,o.jsx("span",{className:"block max-w-full truncate opacity-100",children:r.title})]},r.title)}))}),pe=ue;function me(m){ae(m).then(d=>{const t=f.getState().folders.find(h=>h.id===m);d.folder_name=(t==null?void 0:t.name)||"folder",d.folder_description=(t==null?void 0:t.description)||"";const j=`data:text/json;chatset=utf-8,${encodeURIComponent(JSON.stringify(d))}`,l=document.createElement("a");l.href=j,l.download=`${d.folder_name}.json`,l.click()})}const he=(m,d)=>{const r=f(a=>a.setFolderDragging),t=f(a=>a.setFolderIdDragging),j=_(a=>a.setErrorData),l=f(a=>a.refreshFolders),h=A(a=>a.flows),c=a=>{d&&d(a)},N=async a=>{if(a.dataTransfer.types.some(s=>s==="Files")&&a.dataTransfer.files&&a.dataTransfer.files.length>0){const s=a.dataTransfer.files[0];s.type==="application/json"?S(s):j({title:se,list:[re]})}},i=(a,s)=>{a.preventDefault(),a.dataTransfer.types.some(g=>g==="Files")&&r(!0),t(s)},w=(a,s)=>{a.dataTransfer.types.some(g=>g==="Files")&&r(!0),t(s),a.preventDefault()},y=a=>{a.preventDefault(),a.target===a.currentTarget&&(r(!1),t(""))},x=(a,s)=>{var g,F;if((g=a==null?void 0:a.dataTransfer)!=null&&g.getData("flow")){const v=JSON.parse((F=a==null?void 0:a.dataTransfer)==null?void 0:F.getData("flow"));if(v){B(v.id,s);return}}a.preventDefault(),N(a)},B=(a,s)=>{const g=h.find(I=>I.id===a);if(!g)throw new Error("Flow not found");const F={...g,folder_id:s},v=ne(F,h);F.name=v,r(!1),t(""),oe(F).then(()=>{l(),c(s)})},S=a=>{const s=new FormData;s.append("file",a),r(!1),t(""),te(s).then(()=>{l(),c(m)})};return{dragOver:i,dragEnter:w,dragLeave:y,onDrop:x}},ge=({pathname:m,handleChangeFolder:d,handleDeleteFolder:r})=>{var R;const t=C.useRef(null),j=f(e=>e.setFolders),l=f(e=>e.folders),[h,c]=C.useState({}),N=A(e=>e.takeSnapshot),[i,w]=C.useState(l.map(e=>({name:e.name,edit:!1}))),y=f(e=>e.uploadFolder),x=m.split("/"),B=m.split("/").length<4,S=f(e=>e.myCollectionId),a=f(e=>e.folderIdDragging),s=f(e=>e.refreshFolders),g=e=>B&&e===S?!0:x.includes(e),F=V(),v=((R=F==null?void 0:F.state)==null?void 0:R.folderId)??S,I=f(e=>e.getFolderById),z=_(e=>e.setErrorData),H=_(e=>e.setSuccessData),W=()=>{I(v)},{dragOver:G,dragEnter:J,dragLeave:K,onDrop:M}=he(v,W),X=()=>{y(v).then(()=>{I(v),H({title:"Uploaded successfully"})}).catch(e=>{console.log(e),z({title:"Error on upload",list:[e.response.data]})})},Y=e=>{me(e)};function Z(){de({name:"New Folder",parent_id:null,description:""}).then(e=>{s()})}function q(e,k){const{target:{value:D}}=e;c(n=>({...n,[k]:D}))}C.useEffect(()=>{l.map(e=>({name:e.name,edit:!1}))},[l]);const Q=async e=>{var D,n;const k=i.map(u=>u.name===e.name?{name:e.name,edit:!1}:{name:u.name,edit:!1});if(w(k),h[e.name].trim()!==""){c(E=>({...E,[e.name]:h[e.name]}));const u={...e,name:h[e.name],flows:((D=e.flows)==null?void 0:D.length)>0?e.flows:[],components:((n=e.components)==null?void 0:n.length)>0?e.components:[]},p=await ce(u,e.id),b=l.findIndex(E=>E.id===p.id),O=[...l];O[b]=p,j(O),c({}),w(l.map(E=>({name:E.name,edit:!1})))}else c(u=>({...u,[e.name]:e.name}))};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex shrink-0 items-center justify-between gap-2",children:[o.jsx("div",{className:"flex-1 self-start text-lg font-semibold",children:"Folders"}),o.jsx(T,{variant:"primary",size:"icon",className:"px-2",onClick:Z,"data-testid":"add-folder-button",children:o.jsx($,{name:"FolderPlus",className:"w-4"})}),o.jsx(T,{variant:"primary",size:"icon",className:"px-2",onClick:X,"data-testid":"upload-folder-button",children:o.jsx($,{name:"Upload",className:"w-4"})})]}),o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:o.jsx(o.Fragment,{children:l.map((e,k)=>{const D=i==null?void 0:i.filter(n=>n.name===e.name)[0];return o.jsx("div",{onDragOver:n=>G(n,e.id),onDragEnter:n=>J(n,e.id),onDragLeave:K,onDrop:n=>M(n,e.id),"data-testid":`sidebar-nav-${e.name}`,className:P(U({variant:"ghost"}),g(e.id)?"border border-border bg-muted hover:bg-muted":"border hover:bg-transparent lg:border-transparent lg:hover:border-border","group flex w-full shrink-0 cursor-pointer gap-2 opacity-100 lg:min-w-full",a===e.id?"bg-border":""),onClick:()=>d(e.id),children:o.jsxs("div",{onDoubleClick:n=>{var u;if(e.name!=="My Projects"){if(h[e.name]||c({[e.name]:e.name}),(u=i.find(p=>p.name===e.name))!=null&&u.name){const p=i.map(b=>b.name===e.name?{name:e.name,edit:!0}:{name:b.name,edit:!1});w(p),N(),n.stopPropagation(),n.preventDefault();return}w(p=>[...p,{name:e.name,edit:!0}]),c(p=>({...p,[e.name]:e.name})),N(),n.stopPropagation(),n.preventDefault()}},className:"flex w-full items-center gap-2",children:[o.jsx(L,{name:"folder",className:"mr-2 w-4 flex-shrink-0 justify-start stroke-[1.5] opacity-100"}),D!=null&&D.edit?o.jsx("div",{children:o.jsx(fe,{className:"w-36",onChange:n=>{q(n,e.name)},ref:t,onKeyDown:n=>{var u;if(n.key==="Escape"){const p=i.map(b=>b.name===e.name?{name:e.name,edit:!1}:{name:b.name,edit:!1});w(p),c({}),w(l.map(b=>({name:b.name,edit:!1})))}n.key==="Enter"&&((u=t.current)==null||u.blur()),le(n,n.key,"")},autoFocus:!0,onBlur:async()=>{var n;((n=t.current)==null?void 0:n.value)!==e.name?Q(e):D.edit=!1},value:h[e.name],id:`input-folder-${e.name}`,"data-testid":"input-folder"})}):o.jsx("span",{className:"block w-full truncate opacity-100",children:e.name}),k>0&&o.jsx(T,{"data-testid":"btn-delete-folder",className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{r(e),n.stopPropagation(),n.preventDefault()},variant:"ghost",size:"icon",children:o.jsx(L,{name:"trash",className:"w-4 stroke-[1.5] p-0"})}),o.jsx(T,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{Y(e.id),n.stopPropagation(),n.preventDefault()},unstyled:!0,children:o.jsx(L,{name:"Download",className:"w-4 stroke-[1.5] text-white"})})]})},e.id)})})})]})},Fe=ge;function De({className:m,items:d,handleChangeFolder:r,handleEditFolder:t,handleDeleteFolder:j,...l}){const c=V().pathname,N=f(x=>x.isLoadingFolders),i=f(x=>x.folders),y=["folder","components","flows","all"].some(x=>c.includes(x));return o.jsx("nav",{className:P(m),...l,children:o.jsx(ie,{children:d.length>0?o.jsx(pe,{items:d,pathname:c}):!N&&(i==null?void 0:i.length)>0&&y&&o.jsx(Fe,{pathname:c,handleChangeFolder:r,handleDeleteFolder:j})})})}export{De as S};
