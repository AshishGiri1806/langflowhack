import{r as h,j as e,aw as L,I as D,ax as q,u as _,ay as g,az as de,aA as ue,aB as me,h as w,y as U,S as I,f as F,av as pe,aC as he,aj as fe,aD as xe,aE as ge}from"./index-e8QJh9aC.js";import{u as G,a as je,F as we}from"./form-Bg8t85Kg.js";import{P as ve}from"./index-BnDyGww4.js";import{C as Se,S as K,I as Ce}from"./index-BYkvTyAV.js";import{D as De}from"./index-DU-McIir.js";import{N as ye}from"./index-DsBybX1T.js";import{C as be}from"./checkbox-C_SFShR-.js";import"./label-DasAbf65.js";import"./table-8lEBUpUR.js";import"./index-Dp3cEFDe.js";import"./index-BarjJ5Aq.js";import"./index-CveeD_kd.js";import"./index-ZHR7F3ag.js";import"./index-Cc8e4Dig.js";import"./input-CR-TkjST.js";import"./index-CgG8jb4E.js";import"./popover-eZMmjMhl.js";import"./index-DMsDFRUG.js";function Ne({onFileDrop:t,children:l,dragMessage:r}){const[i,o]=h.useState(!1);h.useEffect(()=>{const d=()=>{document.visibilityState==="visible"&&o(!1)};return document.addEventListener("visibilitychange",d),()=>{document.removeEventListener("visibilitychange",d)}},[]);const n=d=>{d.preventDefault(),d.dataTransfer.types.some(c=>c==="Files")&&t&&o(!0)},s=d=>{d.dataTransfer.types.some(c=>c==="Files")&&t&&o(!0),d.preventDefault()},m=d=>{d.preventDefault(),t&&o(!1)},p=d=>{d.preventDefault(),t&&t(d),o(!1)};return e.jsx("div",{onDragOver:n,onDragEnter:s,onDragLeave:m,onDrop:p,className:L("h-full w-full",i?"mb-36 flex flex-col items-center justify-center gap-4 text-2xl font-light":""),children:i?e.jsxs(e.Fragment,{children:[e.jsx(D,{name:"ArrowUpToLine",className:"h-12 w-12 stroke-1"}),r||"Drop your file here"]}):l})}const Ee=(t,l)=>{var d;const r=q(),i=_(c=>c.setSuccessData),o=_(c=>c.setErrorData),n=g(c=>c.getFolderById),s=(d=r==null?void 0:r.state)==null?void 0:d.folderId,m=g(c=>c.myCollectionId);return[c=>{if(c.preventDefault(),c.dataTransfer.types.some(u=>u==="Files")){const u=c.dataTransfer.files.item(0);if(u.type==="application/json"){const f=new FileReader;f.onload=x=>{const v=x.target.result,b=JSON.parse(v).is_component;t({newProject:!0,file:u,isComponent:l==="all"?null:l==="component"}).then(()=>{i({title:`${b?"Component":"Flow"} uploaded successfully`}),n(s||m)}).catch(N=>{o({title:de,list:[N]})})},f.readAsText(u)}else o({title:ue,list:[me]})}}]},ke=t=>{switch(t){case"all":return"Component or Flow";case"component":return"Component";default:return"Flow"}},Le=(t,l)=>{const r=l==="component",i=(n,s)=>{const m=(n==null?void 0:n.updated_at)||(n==null?void 0:n.date_created),p=(s==null?void 0:s.updated_at)||(s==null?void 0:s.date_created);return m&&p?new Date(p).getTime()-new Date(m).getTime():m?1:p?-1:0},o=l==="all"?t:t==null?void 0:t.filter(n=>((n==null?void 0:n.is_component)??!1)===r);return(o==null?void 0:o.sort(i))??[]},Fe=({})=>{w(r=>r.addFlow),U();const[t,l]=h.useState(!1);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-2 flex w-full items-center justify-center text-center",children:e.jsx("div",{className:"flex-max-width h-full flex-col",children:e.jsxs("div",{className:"align-center flex w-full justify-center gap-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"This folder is empty. New?"}),e.jsxs("span",{className:"transition-colors hover:text-muted-foreground",children:[e.jsx(ye,{open:t,setOpen:l}),e.jsx("button",{onClick:()=>{l(!0)},className:"underline",children:"Start Here"})]}),e.jsx("span",{className:"animate-pulse",children:"ðŸš€"})]})})})})},_e=({handleSelectAll:t,handleDelete:l,handleDuplicate:r,handleExport:i,disableFunctions:o})=>{const[n,s]=h.useState(!0),m=()=>{t(n),s(p=>!p)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center justify-self-start",children:e.jsx("a",{onClick:m,className:"cursor-pointer text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{checked:!n,id:"terms"}),e.jsx("span",{className:"label text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:n?"Select All":"Unselect All"})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(I,{content:o?e.jsx("span",{children:"Select items to export"}):e.jsx("span",{children:"Export selected items"}),children:e.jsx(F,{unstyled:!0,onClick:i,disabled:o,children:e.jsx(D,{name:"FileDown",className:L("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(I,{content:o?e.jsx("span",{children:"Select items to duplicate"}):e.jsx("span",{children:"Duplicate selected items"}),children:e.jsx(F,{unstyled:!0,onClick:r,disabled:o,children:e.jsx(D,{name:"Copy",className:L("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(I,{content:o?e.jsx("span",{children:"Select items to delete"}):e.jsx("span",{children:"Delete selected items"}),children:e.jsx(F,{unstyled:!0,onClick:l,disabled:o,children:e.jsx(D,{name:"Trash2",className:L("h-5 w-5 text-primary transition-all",o?"":"hover:text-status-red")})})})})]})]})})},Te=({item:t,type:l,isLoading:r,control:i})=>{const o=U(),n=t.is_component??!1,s=`/flow/${t.id}`,m=`edit-flow-button-${t.id}`,p=g(v=>v.folderUrl),d=g(v=>v.myCollectionId),u=p!=null&&p!==""?p:d,f=()=>{n||o(s,{state:{folderId:u}})},x=()=>n?null:e.jsx(pe,{to:s,children:e.jsxs(F,{tabIndex:-1,variant:"outline",size:"sm",className:"whitespace-nowrap","data-testid":m,children:[e.jsx(D,{name:"ExternalLink",className:"main-page-nav-button select-none"}),"Edit Flow"]})});return e.jsx(Se,{is_component:l==="component",data:{is_component:n,...t},disabled:r,"data-testid":m,button:x(),onClick:n?void 0:f,playground:!n,control:i})},Oe=(t,l,r,i,o,n,s,m,p,d,c)=>({handleDeleteMultiple:h.useCallback(()=>{l(t).then(()=>{d([]),c(null),r(),i(!0),(!o||o===n)&&s(o||n),m({title:"Selected items deleted successfully"})}).catch(()=>{p({title:"Error deleting items",list:["Please try again"]})})},[t,l,r,i,o,n,s,m,p])}),Ae=(t,l)=>h.useMemo(()=>{const i=n=>({all:"item",component:"component",flow:"flow"})[n]||"",o=n=>({all:"items",component:"components",flow:"flows"})[n]||"";return(t==null?void 0:t.length)===1?i(l):o(l)},[t,l]),Me=(t,l,r)=>{h.useEffect(()=>{const o=he(t||[]).filter(n=>n.name.toLowerCase().includes(l.toLowerCase())||n.description.toLowerCase().includes(l.toLowerCase()));r(l===""?t:o)},[t,l,r])},Ie=(t,l,r,i,o,n,s,m,p,d,c,u)=>({handleDuplicate:h.useCallback(()=>{Promise.all(t.map(x=>l(!0,r.find(v=>v.id===x)))).then(()=>{i(),o(!0),(!n||n===s)&&m(n||s),p({title:`${u} duplicated successfully`}),d([]),c(!1)})},[t,l,r,i,o,n,s,m,p,d,c,u])}),Ue=(t,l,r,i,o,n,s,m,p)=>({handleExport:h.useCallback(()=>{t.forEach(c=>{const u=l.find(f=>f.id===c);u&&r(i({id:u.id,data:u.data,description:u.description,name:u.name,last_tested_version:o,endpoint_name:u.endpoint_name,is_component:!1}),u.name,u.description)}),n({title:`${p} exported successfully`}),s([]),m(!1)},[t,l,r,i,o,n,s,m,p])}),Re=(t,l,r)=>({handleSelectAll:h.useCallback(o=>{const n=t==null?void 0:t.map(s=>s.id);if(o){Object.keys(l()).forEach(s=>{n!=null&&n.includes(s)&&r(s,!0)});return}Object.keys(l()).forEach(s=>{r(s,!1)})},[t,l,r])}),Pe=(t,l,r,i,o)=>({handleSelectOptionsChange:h.useCallback(s=>{if(!((t==null?void 0:t.length)>0)){l({title:"No items selected",list:["Please select items to delete"]});return}s==="delete"?r(!0):s==="duplicate"?i():s==="export"&&o()},[t,l,r,i,o])}),Be=(t,l)=>{h.useEffect(()=>{if(!t||Object.keys(t).length===0)return;const r=Object.keys(t).filter(i=>t[i]===!0);l(r)},[t,l])};function $e({type:t="all"}){var W;const l=w(a=>a.uploadFlow),r=w(a=>a.removeFlow),i=w(a=>a.isLoading),o=w(a=>a.setAllFlows),n=w(a=>a.allFlows),s=g(a=>{var S;return(S=a.selectedFolder)==null?void 0:S.flows}),m=_(a=>a.setSuccessData),p=_(a=>a.setErrorData),[d,c]=h.useState(!1),u=w(a=>a.searchFlowsComponents),f=w(a=>a.setSelectedFlowsComponentsCards),x=w(a=>a.selectedFlowsComponentsCards),[v]=Ee(l,t),[y,b]=h.useState(20),[N,R]=h.useState(1),E=q(),T=Le(n,t),P=(N-1)*y,Q=P+y,j=T==null?void 0:T.slice(P,Q),X=ke(t),C=(W=E==null?void 0:E.state)==null?void 0:W.folderId,O=g(a=>a.getFolderById),A=g(a=>a.myCollectionId),B=g(a=>a.getFoldersApi),Y=g(a=>a.setFolderUrl),Z=w(a=>a.addFlow),$=g(a=>a.isLoadingFolders),V=g(a=>a.setSelectedFolder),z=h.useMemo(()=>window.location.pathname.includes("components")?"Components":window.location.pathname.includes("flows")?"Flows":"Items",[window.location]);h.useEffect(()=>{Y(C??""),f([]),k(!1),O(C||A)},[E]),Me(s,u,o);const H=()=>{R(1),b(20)},{getValues:ee,control:J,setValue:te}=G(),ne=je({control:J}),se=G(),{handleSelectAll:k}=Re(s,ee,te),{handleDuplicate:le}=Ie(x,Z,n,H,B,C,A,O,m,f,k,z),oe=fe(a=>a.version),{handleExport:ae}=Ue(x,n,ge,xe,oe,m,f,k,z),{handleSelectOptionsChange:M}=Pe(x,p,c,le,ae),{handleDeleteMultiple:re}=Oe(x,r,H,B,C,A,O,m,p,o,V);Be(ne,f);const ce=Ae(x,t),ie=()=>{var a;return t==="all"?n==null?void 0:n.length:(a=n==null?void 0:n.filter(S=>(S.is_component??!1)===(t==="component")))==null?void 0:a.length};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full gap-4 pb-5",children:(n==null?void 0:n.length)>0&&e.jsx(_e,{handleDelete:()=>M("delete"),handleSelectAll:k,handleDuplicate:()=>M("duplicate"),handleExport:()=>M("export"),disableFunctions:!((x==null?void 0:x.length)>0)})}),e.jsx(Ne,{onFileDrop:v,dragMessage:`Drag your ${X} here`,children:e.jsxs("div",{className:"flex h-full w-full flex-col justify-between",children:[e.jsx("div",{className:"flex w-full flex-col gap-4",children:!i&&!$&&(j==null?void 0:j.length)===0?e.jsx(Fe,{}):e.jsx("div",{className:"grid w-full gap-4 md:grid-cols-2 lg:grid-cols-2",children:i===!1&&(j==null?void 0:j.length)>0&&$===!1?e.jsx(e.Fragment,{children:j==null?void 0:j.map(a=>h.createElement(we,{...se,key:a.id},e.jsx("form",{children:e.jsx(Te,{item:a,type:t,isLoading:i,control:J})})))}):e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsx(K,{})]})})}),!i&&(j==null?void 0:j.length)>0&&e.jsx("div",{className:"relative py-6",children:e.jsx(ve,{storeComponent:!0,pageIndex:N,pageSize:y,rowsCount:[10,20,50,100],totalRowsCount:ie(),paginate:(a,S)=>{R(S),b(a)}})})]})}),d&&e.jsx(De,{open:d,setOpen:c,onConfirm:re,description:ce,children:e.jsx(e.Fragment,{})})]})}const ze=({tabsOptions:t,setActiveTab:l,loading:r,tabActive:i})=>{const o=U(),n=g(c=>c.folderUrl),s=g(c=>c.myCollectionId),p=n!=null&&n!==""?n:s,d=c=>{const u=window.location.pathname;let f="";switch(c){case"Flows":f=u.replace(/components|all/,"flows");break;case"Components":f=u.replace(/flows|all/,"components");break;default:f=u.replace(/flows|components/,"all");break}o(f,{state:{folderId:p}})};return h.useEffect(()=>{const c=window.location.pathname;c.includes("components")?l("Components"):c.includes("flows")?l("Flows"):l("All")},[window.location.pathname]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"ml-4 flex w-full gap-2 border-b border-border",children:t.map((c,u)=>e.jsx("button",{"data-testid":`${c}-button-store`,disabled:r,onClick:()=>{d(c)},className:(i===c?"border-b-2 border-primary p-3":"border-b-2 border-transparent p-3 text-muted-foreground hover:text-primary")+(r?" cursor-not-allowed":""),children:c},u))})})},He=({})=>{const t=w(s=>s.isLoading),[l,r]=h.useState("Flows"),[i,o]=h.useState(""),n=w(s=>s.setSearchFlowsComponents);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex items-end gap-4",children:[e.jsx(Ce,{loading:t,value:i,onChange:s=>{n(s.target.value),o(s.target.value)},onKeyDown:s=>{s.key==="Enter"&&n(i)}}),e.jsx(ze,{tabsOptions:["All","Flows","Components"],setActiveTab:r,loading:t,tabActive:l})]})})},ct=({type:t})=>e.jsxs(e.Fragment,{children:[e.jsx(He,{}),e.jsx("div",{className:"mt-5 flex h-full flex-col",children:e.jsx($e,{type:t},t)})]});export{ct as default};
